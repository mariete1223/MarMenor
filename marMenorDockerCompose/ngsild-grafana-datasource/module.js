/*! For license information please see module.js.LICENSE.txt */
define(["@grafana/data","@grafana/runtime","@grafana/ui","lodash","react"],((e,t,r,n,o)=>(()=>{var i=[e=>{e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},(e,t,r)=>{var n=r(6),o=r(24),i=r(25),a=n?n.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":a&&a in Object(e)?o(e):i(e)}},(e,t,r)=>{var n=r(7),o="object"==typeof self&&self&&self.Object===Object&&self,i=n||o||Function("return this")();e.exports=i},e=>{e.exports=function(e){return null!=e&&"object"==typeof e}},e=>{e.exports=function(e){return e}},(e,t,r)=>{var n=r(1),o=r(0);e.exports=function(e){if(!o(e))return!1;var t=n(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}},(e,t,r)=>{var n=r(2).Symbol;e.exports=n},(e,t,r)=>{var n="object"==typeof r.g&&r.g&&r.g.Object===Object&&r.g;e.exports=n},e=>{e.exports=function(e,t){return e===t||e!=e&&t!=t}},(e,t,r)=>{var n=r(5),o=r(10);e.exports=function(e){return null!=e&&o(e.length)&&!n(e)}},e=>{e.exports=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}},e=>{var t=/^(?:0|[1-9]\d*)$/;e.exports=function(e,r){var n=typeof e;return!!(r=null==r?9007199254740991:r)&&("number"==n||"symbol"!=n&&t.test(e))&&e>-1&&e%1==0&&e<r}},(e,t,r)=>{e=r.nmd(e);var n=r(2),o=r(38),i=t&&!t.nodeType&&t,a=i&&e&&!e.nodeType&&e,u=a&&a.exports===i?n.Buffer:void 0,l=(u?u.isBuffer:void 0)||o;e.exports=l},(e,t,r)=>{e=r.nmd(e);var n=r(7),o=t&&!t.nodeType&&t,i=o&&e&&!e.nodeType&&e,a=i&&i.exports===o&&n.process,u=function(){try{var e=i&&i.require&&i.require("util").types;return e||a&&a.binding&&a.binding("util")}catch(e){}}();e.exports=u},(e,t,r)=>{var n=r(15),o=r(8),i=r(31),a=r(32),u=Object.prototype,l=u.hasOwnProperty,c=n((function(e,t){e=Object(e);var r=-1,n=t.length,c=n>2?t[2]:void 0;for(c&&i(t[0],t[1],c)&&(n=1);++r<n;)for(var s=t[r],f=a(s),p=-1,d=f.length;++p<d;){var y=f[p],h=e[y];(void 0===h||o(h,u[y])&&!l.call(e,y))&&(e[y]=s[y])}return e}));e.exports=c},(e,t,r)=>{var n=r(4),o=r(16),i=r(18);e.exports=function(e,t){return i(o(e,t,n),e+"")}},(e,t,r)=>{var n=r(17),o=Math.max;e.exports=function(e,t,r){return t=o(void 0===t?e.length-1:t,0),function(){for(var i=arguments,a=-1,u=o(i.length-t,0),l=Array(u);++a<u;)l[a]=i[t+a];a=-1;for(var c=Array(t+1);++a<t;)c[a]=i[a];return c[t]=r(l),n(e,this,c)}}},e=>{e.exports=function(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}},(e,t,r)=>{var n=r(19),o=r(30)(n);e.exports=o},(e,t,r)=>{var n=r(20),o=r(21),i=r(4),a=o?function(e,t){return o(e,"toString",{configurable:!0,enumerable:!1,value:n(t),writable:!0})}:i;e.exports=a},e=>{e.exports=function(e){return function(){return e}}},(e,t,r)=>{var n=r(22),o=function(){try{var e=n(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();e.exports=o},(e,t,r)=>{var n=r(23),o=r(29);e.exports=function(e,t){var r=o(e,t);return n(r)?r:void 0}},(e,t,r)=>{var n=r(5),o=r(26),i=r(0),a=r(28),u=/^\[object .+?Constructor\]$/,l=Function.prototype,c=Object.prototype,s=l.toString,f=c.hasOwnProperty,p=RegExp("^"+s.call(f).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=function(e){return!(!i(e)||o(e))&&(n(e)?p:u).test(a(e))}},(e,t,r)=>{var n=r(6),o=Object.prototype,i=o.hasOwnProperty,a=o.toString,u=n?n.toStringTag:void 0;e.exports=function(e){var t=i.call(e,u),r=e[u];try{e[u]=void 0;var n=!0}catch(e){}var o=a.call(e);return n&&(t?e[u]=r:delete e[u]),o}},e=>{var t=Object.prototype.toString;e.exports=function(e){return t.call(e)}},(e,t,r)=>{var n,o=r(27),i=(n=/[^.]+$/.exec(o&&o.keys&&o.keys.IE_PROTO||""))?"Symbol(src)_1."+n:"";e.exports=function(e){return!!i&&i in e}},(e,t,r)=>{var n=r(2)["__core-js_shared__"];e.exports=n},e=>{var t=Function.prototype.toString;e.exports=function(e){if(null!=e){try{return t.call(e)}catch(e){}try{return e+""}catch(e){}}return""}},e=>{e.exports=function(e,t){return null==e?void 0:e[t]}},e=>{var t=Date.now;e.exports=function(e){var r=0,n=0;return function(){var o=t(),i=16-(o-n);if(n=o,i>0){if(++r>=800)return arguments[0]}else r=0;return e.apply(void 0,arguments)}}},(e,t,r)=>{var n=r(8),o=r(9),i=r(11),a=r(0);e.exports=function(e,t,r){if(!a(r))return!1;var u=typeof t;return!!("number"==u?o(r)&&i(t,r.length):"string"==u&&t in r)&&n(r[t],e)}},(e,t,r)=>{var n=r(33),o=r(42),i=r(9);e.exports=function(e){return i(e)?n(e,!0):o(e)}},(e,t,r)=>{var n=r(34),o=r(35),i=r(37),a=r(12),u=r(11),l=r(39),c=Object.prototype.hasOwnProperty;e.exports=function(e,t){var r=i(e),s=!r&&o(e),f=!r&&!s&&a(e),p=!r&&!s&&!f&&l(e),d=r||s||f||p,y=d?n(e.length,String):[],h=y.length;for(var v in e)!t&&!c.call(e,v)||d&&("length"==v||f&&("offset"==v||"parent"==v)||p&&("buffer"==v||"byteLength"==v||"byteOffset"==v)||u(v,h))||y.push(v);return y}},e=>{e.exports=function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}},(e,t,r)=>{var n=r(36),o=r(3),i=Object.prototype,a=i.hasOwnProperty,u=i.propertyIsEnumerable,l=n(function(){return arguments}())?n:function(e){return o(e)&&a.call(e,"callee")&&!u.call(e,"callee")};e.exports=l},(e,t,r)=>{var n=r(1),o=r(3);e.exports=function(e){return o(e)&&"[object Arguments]"==n(e)}},e=>{var t=Array.isArray;e.exports=t},e=>{e.exports=function(){return!1}},(e,t,r)=>{var n=r(40),o=r(41),i=r(13),a=i&&i.isTypedArray,u=a?o(a):n;e.exports=u},(e,t,r)=>{var n=r(1),o=r(10),i=r(3),a={};a["[object Float32Array]"]=a["[object Float64Array]"]=a["[object Int8Array]"]=a["[object Int16Array]"]=a["[object Int32Array]"]=a["[object Uint8Array]"]=a["[object Uint8ClampedArray]"]=a["[object Uint16Array]"]=a["[object Uint32Array]"]=!0,a["[object Arguments]"]=a["[object Array]"]=a["[object ArrayBuffer]"]=a["[object Boolean]"]=a["[object DataView]"]=a["[object Date]"]=a["[object Error]"]=a["[object Function]"]=a["[object Map]"]=a["[object Number]"]=a["[object Object]"]=a["[object RegExp]"]=a["[object Set]"]=a["[object String]"]=a["[object WeakMap]"]=!1,e.exports=function(e){return i(e)&&o(e.length)&&!!a[n(e)]}},e=>{e.exports=function(e){return function(t){return e(t)}}},(e,t,r)=>{var n=r(0),o=r(43),i=r(44),a=Object.prototype.hasOwnProperty;e.exports=function(e){if(!n(e))return i(e);var t=o(e),r=[];for(var u in e)("constructor"!=u||!t&&a.call(e,u))&&r.push(u);return r}},e=>{var t=Object.prototype;e.exports=function(e){var r=e&&e.constructor;return e===("function"==typeof r&&r.prototype||t)}},e=>{e.exports=function(e){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t}},e=>{"use strict";e.exports=o},e=>{"use strict";e.exports=r},t=>{"use strict";t.exports=e},e=>{"use strict";e.exports=t},,e=>{"use strict";e.exports=n}],a={};function u(e){var t=a[e];if(void 0!==t)return t.exports;var r=a[e]={id:e,loaded:!1,exports:{}};return i[e](r,r.exports,u),r.loaded=!0,r.exports}u.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return u.d(t,{a:t}),t},u.d=(e,t)=>{for(var r in t)u.o(t,r)&&!u.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},u.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),u.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),u.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},u.nmd=e=>(e.paths=[],e.children||(e.children=[]),e);var l={};return(()=>{"use strict";u.r(l),u.d(l,{plugin:()=>ur});var e,t=u(47),r=u(14),n=u.n(r),o=u(48);!function(e){e.ENTITY="entity",e.MULTITEMPORAL="multitemporal",e.TEMPORAL="temporal",e.GEO="geo",e.TYPES="type",e.VERSION="version",e.ATTRIBUTES="attributes",e.NODE_GRAPH="nodegraph"}(e||(e={}));var i;!function(e){e.TOTAL_COUNT="totalCount",e.DISTINCT_COUNT="distinctCount",e.SUM="sum",e.AVERAGE="avg",e.MIN="min",e.MAX="max",e.STANDARD_DEVIATION="stddev",e.SUM_SQUARE="sumsq"}(i||(i={}));var a,c=function(e){if(e)switch(e.toLowerCase()){case"totalcount":case"total_count":return i.TOTAL_COUNT;case"distinctcount":case"distinct_count":return i.DISTINCT_COUNT;case"sum":return i.SUM;case"avg":case"average":return i.AVERAGE;case"min":return i.MIN;case"max":return i.MAX;case"stddev":case"standard_deviation":return i.STANDARD_DEVIATION;case"sumsq":case"sumsquare":case"sum_square":return i.SUM_SQUARE;default:return}};!function(e){e.NONE="none",e.NEAR="near",e.EQUALS="equals",e.DISJOINT="disjoint",e.INTERSECTS="intersects",e.WITHIN="within",e.CONTAINS="contains",e.OVERLAPS="overlaps"}(a||(a={}));var s=function(e){if(!e)return a.NONE;if("near"===(e=e.toLowerCase())||e.startsWith("near;"))return a.NEAR;switch(e.toLowerCase()){case"equals":return a.EQUALS;case"disjoint":return a.DISJOINT;case"intersects":return a.INTERSECTS;case"within":return a.WITHIN;case"contains":return a.CONTAINS;case"overlaps":return a.OVERLAPS;default:return a.NONE}},f={queryType:e.TEMPORAL.valueOf()};function p(e){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},p(e)}function d(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,y(n.key),n)}}function y(e){var t=function(e,t){if("object"!=p(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=p(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==p(t)?t:String(t)}var h=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,n;return t=e,n=[{key:"concatPaths",value:function(e,t){if(!e)return t;if(!t)return e;var r=e.endsWith("/"),n=t.startsWith("/");return r&&n?t=t.substring(1):r||n||(t="/"+t),e+t}},{key:"appendQueryParam",value:function(e,t){var r=e.indexOf("?")>=0?"&":"?";return e+r+t}}],(r=null)&&d(t.prototype,r),n&&d(t,n),Object.defineProperty(t,"prototype",{writable:!1}),e}(),v={CEL:"°C",KEL:"K",MTR:"m",CMT:"cm",DMT:"dm",MMT:"mm",KTM:"km",KMT:"km",C81:"rad",DD:"°",D61:"'",D62:'"',C47:"ns",B98:"µs",C26:"ms",SEC:"s",MIN:"min",HUR:"h",DAY:"d",ANN:"y",MTS:"m/s",KMH:"km/h","2X":"m/min",M62:"km/s",MSK:"m/s²","2A":"rad/s",M46:"r/min",MGM:"mg",GRM:"g",KGM:"kg",TNE:"t",KTN:"kt",74:"mPa",PAL:"Pa",KPA:"kPa",HBA:"hbar",MBR:"mbar",BAR:"bar",KBA:"kbar",ATM:"atm",JOU:"J",KJO:"kJ","3B":"MJ",GV:"GJ",WHR:"Wh",KWH:"kWh",MWH:"MWh",GWH:"GWh",A53:"eV",B29:"keV",B71:"MeV",A85:"GeV",C31:"mW",WTT:"W",KWT:"kW",MAW:"MW",A90:"GW",D46:"VA",KVA:"kVA",MVA:"MVA",AMP:"A",B22:"kA","4K":"mA",COU:"C",AMH:"Ah",TAH:"kAh",VLT:"V",KVT:"kV","2Z":"mV",D50:"V/m",D33:"T",C29:"mT",OHM:"Ω",E45:"mΩ",B49:"kΩ",B75:"MΩ",MTK:"m²",MTQ:"m³",LTR:"l",MLT:"ml",HTZ:"Hz",NEW:"N",C62:"",KGS:"kg/s",MQS:"m³/s",MQH:"m³/h",B11:"J/(kg K)",B43:"kJ/(kg K)","2N":"dB",BQL:"Bq"};function m(e){return m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},m(e)}var b=function(e){if(null!=e){if("object"!==m(e))return e;if(void 0!==(null==e?void 0:e.value))return"object"===m(e.value)&&"@value"in e.value?e.value["@value"]:e.value}},g=function(e){var t=b(e);if(isFinite(t)&&"object"===m(e)){var r=e.unitCode;r&&(t=t+((r=v[r]||r).startsWith("°")?"":" ")+r)}return t},E=Object.freeze(["id","type","@context"]),w=u(50);function O(e){return O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},O(e)}function T(e){return function(e){if(Array.isArray(e))return S(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return S(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return S(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function C(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,A(n.key),n)}}function A(e){var t=function(e,t){if("object"!=O(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=O(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==O(t)?t:String(t)}var j=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var r,n,o;return r=e,o=[{key:"handleGeoResult",value:function(e,r){var n=e.map((function(e){return Object.keys(e)})).flatMap((function(e){return e})).filter((function(e){return"@context"!==e&&"location"!==e&&"operationSpace"!==e&&"observationSpace"!==e})),o=(n=T(new Set(n))).map((function(e){return{name:e,values:[]}})),i={name:"longitude",values:[]},a={name:"latitude",values:[]},u={name:"name",values:[]};return e.forEach((function(e){var t=e.location,r=null==t?void 0:t.value;if("Point"===r.type){o.forEach((function(t){var r=b(e[t.name]);t.values.push(r)}));var n=r.coordinates;i.values.push(n[0]),a.values.push(n[1]);var l=e.id,c=l.lastIndexOf(":");c>=0&&c<l.length-1&&(l=l.substring(c+1)),u.values.push(l)}})),[a,i,u].forEach((function(e){return o.unshift(e)})),new t.MutableDataFrame({refId:r,fields:o})}}],(n=null)&&C(r.prototype,n),o&&C(r,o),Object.defineProperty(r,"prototype",{writable:!1}),e}();function I(e){return I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},I(e)}function x(e){return function(e){if(Array.isArray(e))return L(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||k(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function P(){P=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var i=t&&t.prototype instanceof m?t:m,a=Object.create(i.prototype),u=new _(n||[]);return o(a,"_invoke",{value:A(e,r,u)}),a}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var p="suspendedStart",d="suspendedYield",y="executing",h="completed",v={};function m(){}function b(){}function g(){}var E={};c(E,a,(function(){return this}));var w=Object.getPrototypeOf,O=w&&w(w(k([])));O&&O!==r&&n.call(O,a)&&(E=O);var T=g.prototype=m.prototype=Object.create(E);function S(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function C(e,t){function r(o,i,a,u){var l=f(e[o],e,i);if("throw"!==l.type){var c=l.arg,s=c.value;return s&&"object"==I(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,a,u)}),(function(e){r("throw",e,a,u)})):t.resolve(s).then((function(e){c.value=e,a(c)}),(function(e){return r("throw",e,a,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return i=i?i.then(o,o):o()}})}function A(t,r,n){var o=p;return function(i,a){if(o===y)throw new Error("Generator is already running");if(o===h){if("throw"===i)throw a;return{value:e,done:!0}}for(n.method=i,n.arg=a;;){var u=n.delegate;if(u){var l=j(u,n);if(l){if(l===v)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===p)throw o=h,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=y;var c=f(t,r,n);if("normal"===c.type){if(o=n.done?h:d,c.arg===v)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(o=h,n.method="throw",n.arg=c.arg)}}}function j(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,j(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function x(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function N(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function _(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(x,this),this.reset(!0)}function k(t){if(t||""===t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return i.next=i}}throw new TypeError(I(t)+" is not iterable")}return b.prototype=g,o(T,"constructor",{value:g,configurable:!0}),o(g,"constructor",{value:b,configurable:!0}),b.displayName=c(g,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,c(e,l,"GeneratorFunction")),e.prototype=Object.create(T),e},t.awrap=function(e){return{__await:e}},S(C.prototype),c(C.prototype,u,(function(){return this})),t.AsyncIterator=C,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new C(s(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},S(T),c(T,l,"Generator"),c(T,a,(function(){return this})),c(T,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=k,_.prototype={constructor:_,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(N),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return u.type="throw",u.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],u=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var l=n.call(a,"catchLoc"),c=n.call(a,"finallyLoc");if(l&&c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),N(r),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;N(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:k(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),v}},t}function N(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i,a,u=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=i.call(r)).done)&&(u.push(n.value),u.length!==t);l=!0);}catch(e){c=!0,o=e}finally{try{if(!l&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw o}}return u}}(e,t)||k(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=k(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){u=!0,i=e},f:function(){try{a||null==r.return||r.return()}finally{if(u)throw i}}}}function k(e,t){if(e){if("string"==typeof e)return L(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?L(e,t):void 0}}function L(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function M(e,t,r,n,o,i,a){try{var u=e[i](a),l=u.value}catch(e){return void r(e)}u.done?t(l):Promise.resolve(l).then(n,o)}function D(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){M(i,n,o,a,u,"next",e)}function u(e){M(i,n,o,a,u,"throw",e)}a(void 0)}))}}function G(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,F(n.key),n)}}function F(e){var t=function(e,t){if("object"!=I(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=I(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==I(t)?t:String(t)}var R=function(){function r(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this.datasource=e,this.query=t}var n,o,i,a,u,l;return n=r,o=[{key:"handleGraphResult",value:(l=D(P().mark((function e(r,n){var o,i,a,u,l,c,s,f,p,d,y,h,v,m,E,w,O,T,S,C,A,j,I,x=this;return P().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.resolveMissingEntities(r,n);case 2:r=e.sent,o=function(e){var t=e.id;if(x.query.useLongEntityName)return t;var r=t.lastIndexOf(":");return r>0&&r<t.length-1?t.substring(r+1):t},i={name:"id",values:[],type:t.FieldType.string},a={name:"title",values:[],type:t.FieldType.string},u={name:"suntitle",values:[],type:t.FieldType.string},l={name:"mainStat",values:[],type:t.FieldType.string,config:{}},c={name:"secondaryStat",values:[],type:t.FieldType.string,config:{}},s={name:"arc__zone1",values:[],type:t.FieldType.number,config:{color:{mode:"fixed",fixedColor:"green"}}},f={name:"arc__zone2",values:[],type:t.FieldType.number,config:{color:{mode:"fixed",fixedColor:"red"}}},p={name:"arc__neutral",values:[],type:t.FieldType.number,config:{displayName:"n.a."}},d=function(e,t,r){if(t){var n=t[e.type]||t[""];if(n){var o=n.find((function(t){return t in e}));if(o){if(null!=r&&r.returnAttribute)return o;var i=e[o];return Array.isArray(i)&&i.length>0&&(i=i[0]),null!=r&&r.skipUnit?b(i):g(i)}}}},y=function(e,t){if(t){var n=r.find((function(e){return d(e,t,{returnAttribute:!0})}));if(n){var o=d(n,t,{returnAttribute:!0});e.config.displayName=o}}},y(l,this.query.primaryNodeAttributes),y(c,this.query.secondaryNodeAttributes),this.query.arcColorNodeAttributes&&(h=r.find((function(e){return d(e,x.query.arcColorNodeAttributes,{returnAttribute:!0})})))&&(v=d(h,this.query.arcColorNodeAttributes,{returnAttribute:!0}),s.config.displayName=v,f.config.displayName=this.query.arcColorComplementLabel||"~"+v,this.query.primaryArcColor&&(s.config.color.fixedColor=this.query.primaryArcColor),this.query.secondaryArcColor&&(f.config.color.fixedColor=this.query.secondaryArcColor)),r.forEach((function(e){var t,r,n,y=o(e),h=e.type,v=h.lastIndexOf(".");v>=0&&v<h.length-1&&(h=h.substring(v+1));var m=y.indexOf(h)>=0?"":h;i.values.push(e.id),a.values.push(y),u.values.push(m),l.values.push(d(e,null===(t=x.query)||void 0===t?void 0:t.primaryNodeAttributes)),c.values.push(d(e,null===(r=x.query)||void 0===r?void 0:r.secondaryNodeAttributes));var b=d(e,null===(n=x.query)||void 0===n?void 0:n.arcColorNodeAttributes,{skipUnit:!0}),g=1-b,E=isFinite(b)?0:1;s.values.push(b),f.values.push(g),p.values.push(E)})),m={name:"id",values:[],type:t.FieldType.string},E={name:"source",values:[],type:t.FieldType.string},w={name:"target",values:[],type:t.FieldType.string},O={name:"mainStat",values:[]},T=_(r),e.prev=23,C=P().mark((function e(){var t;return P().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=S.value,Object.entries(t).filter((function(e){var t=N(e,2),n=(t[0],t[1]);return"Relationship"===(null==n?void 0:n.type)&&void 0!==(null==n?void 0:n.object)&&void 0!==r.find((function(e){return e.id===n.object}))})).forEach((function(e){var r=N(e,2),n=r[0],o=r[1];m.values.push(t.id+"__"+n),E.values.push(t.id),w.values.push(o.object),O.values.push(n)}));case 3:case"end":return e.stop()}}),e)})),T.s();case 26:if((S=T.n()).done){e.next=30;break}return e.delegateYield(C(),"t0",28);case 28:e.next=26;break;case 30:e.next=35;break;case 32:e.prev=32,e.t1=e.catch(23),T.e(e.t1);case 35:return e.prev=35,T.f(),e.finish(35);case 38:return A=[i,a,u],this.query.primaryNodeAttributes&&A.push(l),this.query.secondaryNodeAttributes&&A.push(c),this.query.arcColorNodeAttributes&&(A.push(s,f),p.values.findIndex((function(e){return e>0}))>=0&&A.push(p)),j=new t.MutableDataFrame({refId:this.query.refId,fields:A,meta:{preferredVisualisationType:"nodeGraph"},name:"nodes"}),I=new t.MutableDataFrame({refId:this.query.refId,fields:[m,E,w,O],meta:{preferredVisualisationType:"nodeGraph"},name:"edges"}),e.abrupt("return",[j,I]);case 45:case"end":return e.stop()}}),e,this,[[23,32,35,38]])}))),function(e,t){return l.apply(this,arguments)})},{key:"resolveMissingEntities",value:(u=D(P().mark((function e(t,r){var n,o,i,a,u,l,c,s=arguments;return P().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=s.length>2&&void 0!==s[2]?s[2]:0,!(r<=0)){e.next=3;break}return e.abrupt("return",t);case 3:for(o=new Set,i=n;i<t.length;i++)a=t[i],Object.entries(a).filter((function(e){var t=N(e,2),r=(t[0],t[1]);return"Relationship"===(null==r?void 0:r.type)&&void 0!==(null==r?void 0:r.object)})).map((function(e){var t=N(e,2);return t[0],t[1].object})).filter((function(e){return void 0===t.find((function(t){return t.id===e}))})).forEach((function(e){return o.add(e)}));return e.next=7,this.getEntites(o);case 7:if(0!==(u=e.sent).length){e.next=10;break}return e.abrupt("return",t);case 10:return l=t.length,t.push.apply(t,x(u)),e.next=14,this.resolveMissingEntities(t,r--,l);case 14:return c=e.sent,e.abrupt("return",c);case 16:case"end":return e.stop()}}),e,this)}))),function(e,t){return u.apply(this,arguments)})},{key:"getEntites",value:(a=D(P().mark((function t(r){var n,o,i;return P().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==r.size){t.next=2;break}return t.abrupt("return",[]);case 2:return n=x(r).join(","),t.next=5,this.datasource.request({queryType:e.ENTITY,entityId:n});case 5:if(o=t.sent,i=o.data){t.next=9;break}return t.abrupt("return",[]);case 9:return Array.isArray(i)||(i=[i]),t.abrupt("return",i);case 11:case"end":return t.stop()}}),t,this)}))),function(e){return a.apply(this,arguments)})}],o&&G(n.prototype,o),i&&G(n,i),Object.defineProperty(n,"prototype",{writable:!1}),r}();function q(e){return function(e){if(Array.isArray(e))return Y(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||V(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function U(e){return U="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},U(e)}function B(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=V(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){u=!0,i=e},f:function(){try{a||null==r.return||r.return()}finally{if(u)throw i}}}}function V(e,t){if(e){if("string"==typeof e)return Y(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Y(e,t):void 0}}function Y(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Q(){Q=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var i=t&&t.prototype instanceof m?t:m,a=Object.create(i.prototype),u=new P(n||[]);return o(a,"_invoke",{value:A(e,r,u)}),a}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var p="suspendedStart",d="suspendedYield",y="executing",h="completed",v={};function m(){}function b(){}function g(){}var E={};c(E,a,(function(){return this}));var w=Object.getPrototypeOf,O=w&&w(w(N([])));O&&O!==r&&n.call(O,a)&&(E=O);var T=g.prototype=m.prototype=Object.create(E);function S(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function C(e,t){function r(o,i,a,u){var l=f(e[o],e,i);if("throw"!==l.type){var c=l.arg,s=c.value;return s&&"object"==U(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,a,u)}),(function(e){r("throw",e,a,u)})):t.resolve(s).then((function(e){c.value=e,a(c)}),(function(e){return r("throw",e,a,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return i=i?i.then(o,o):o()}})}function A(t,r,n){var o=p;return function(i,a){if(o===y)throw new Error("Generator is already running");if(o===h){if("throw"===i)throw a;return{value:e,done:!0}}for(n.method=i,n.arg=a;;){var u=n.delegate;if(u){var l=j(u,n);if(l){if(l===v)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===p)throw o=h,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=y;var c=f(t,r,n);if("normal"===c.type){if(o=n.done?h:d,c.arg===v)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(o=h,n.method="throw",n.arg=c.arg)}}}function j(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,j(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function I(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function x(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(I,this),this.reset(!0)}function N(t){if(t||""===t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return i.next=i}}throw new TypeError(U(t)+" is not iterable")}return b.prototype=g,o(T,"constructor",{value:g,configurable:!0}),o(g,"constructor",{value:b,configurable:!0}),b.displayName=c(g,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,c(e,l,"GeneratorFunction")),e.prototype=Object.create(T),e},t.awrap=function(e){return{__await:e}},S(C.prototype),c(C.prototype,u,(function(){return this})),t.AsyncIterator=C,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new C(s(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},S(T),c(T,l,"Generator"),c(T,a,(function(){return this})),c(T,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=N,P.prototype={constructor:P,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(x),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return u.type="throw",u.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],u=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var l=n.call(a,"catchLoc"),c=n.call(a,"finallyLoc");if(l&&c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),x(r),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;x(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:N(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),v}},t}function W(e,t,r,n,o,i,a){try{var u=e[i](a),l=u.value}catch(e){return void r(e)}u.done?t(l):Promise.resolve(l).then(n,o)}function H(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){W(i,n,o,a,u,"next",e)}function u(e){W(i,n,o,a,u,"throw",e)}a(void 0)}))}}function K(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,te(n.key),n)}}function J(e,t,r){return t=z(t),function(e,t){if(t&&("object"===U(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return X(e)}(e,$()?Reflect.construct(t,r||[],z(e).constructor):t.apply(e,r))}function $(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return($=function(){return!!e})()}function z(e){return z=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},z(e)}function X(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Z(e,t){return Z=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Z(e,t)}function ee(e,t,r){return(t=te(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function te(e){var t=function(e,t){if("object"!=U(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=U(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==U(t)?t:String(t)}var re,ne,oe,ie,ae=function(r){function i(e){var t,r,n,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),ee(X(o=J(this,i,[e])),"baseUrl",void 0),ee(X(o),"timeseriesUrl",void 0),ee(X(o),"contextUrl",void 0),ee(X(o),"contextLinkHeader",void 0);var a=e.url||"";a.indexOf("/ngsi-ld/v1")<0&&(a=h.concatPaths(a,"/ngsi-ld/v1")),o.baseUrl=a;var u=(null===(t=e.jsonData)||void 0===t?void 0:t.timeseriesUrl)||"",l="proxy"===e.access?h.concatPaths((null===(r=e.url)||void 0===r?void 0:r.replace("/ngsi-ld/v1",""))||"","temporal"):u;return o.timeseriesUrl=l,o.contextUrl=(null===(n=e.jsonData)||void 0===n?void 0:n.contextUrl)||"",o.contextLinkHeader=o.contextUrl?"<"+o.contextUrl+'>; rel="http://www.w3.org/ns/json-ld#context"; type="application/ld+json"':"",o}var a,u,l,c,s,p,d,y,v;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Z(e,t)}(i,r),a=i,u=[{key:"query",value:(v=H(Q().mark((function e(t){var r,i,a,u,l=this;return Q().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(0,o.getBackendSrv)(),i=t.range,a=t.targets.map((function(e){var t,o;return l.querySingle(n()(e,f),{backend:r,from:null==i||null===(t=i.from)||void 0===t?void 0:t.valueOf(),to:null==i||null===(o=i.to)||void 0===o?void 0:o.valueOf()})})),e.next=5,Promise.all(a);case 5:return u=e.sent.filter((function(e){return(null==e?void 0:e.length)>0})).flatMap((function(e){return e})),e.abrupt("return",{data:u});case 7:case"end":return e.stop()}}),e)}))),function(e){return v.apply(this,arguments)})},{key:"metricFindQuery",value:(y=H(Q().mark((function e(t,r){var n,o,i,a,u,l;return Q().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.indexOf("|"),o="id",-1!==n&&(i=t.split("|"),t=i[0],o=i[1]),e.next=5,this.requestSimple(t,r);case 5:return a=e.sent,u=a.data,l=function(e,t){return"string"!=typeof e[t]?b(e[t]):e[t]},e.abrupt("return",Array.isArray(u)?u.map((function(e){return{text:l(e,o)}})):[{text:u[o].toString()}]);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return y.apply(this,arguments)})},{key:"addDataToFrame",value:function(e,r,n,o,i,a){var u,l=B(r);try{var c=function(){var r=u.value,l=r.id;if(!n.useLongEntityName){var c=l.lastIndexOf(":");c>=0&&c<l.length-1&&(l=l.substring(c+1))}var s=Object.keys(r);E.forEach((function(e){var t=s.indexOf(e);t>=0&&s.splice(t,1)}));for(var f=0,p=s;f<p.length;f++){var d=p[f];if("Relationship"!==r[d].type)if(r[d].values){var y=r[d].values,h=i;""===h&&(h=d),""!==o&&(h=h+":"+o);var v={name:l+":"+h,values:y.map((function(e){return e[0]})),type:t.FieldType.number},m={name:"Time",values:y.map((function(e){return new Date(e[1]).getTime()})),type:t.FieldType.time};e.push(new t.MutableDataFrame({refId:n.refId,fields:[m,v]}))}else if(void 0!==r[d].value){var b=r[d].value;"object"===U(b)&&"@value"in b&&(b=b["@value"]),(0,w.isNumber)(b)?t.FieldType.number:"string"==typeof b?t.FieldType.string:!1===b||!0===b?t.FieldType.boolean:t.FieldType.other;var g={name:l+":"+d,values:[b],type:t.FieldType.number},O={name:"Time",values:[isFinite(r[d].observedAt)?r[d].observedAt:isFinite(null==a?void 0:a.from)&&isFinite(null==a?void 0:a.to)?((null==a?void 0:a.from)+(null==a?void 0:a.to))/2:isFinite(null==a?void 0:a.from)?null==a?void 0:a.from:isFinite(null==a?void 0:a.to)?a.to:Date.now()],type:t.FieldType.time};e.push(new t.MutableDataFrame({refId:n.refId,fields:[O,g]}))}}};for(l.s();!(u=l.n()).done;)c()}catch(e){l.e(e)}finally{l.f()}}},{key:"querySingle",value:(d=H(Q().mark((function t(r,n){var i,a,u,l,c,s,f,p,d,y,h,v,m,g,E,w,O,T,S,C,A,I,x,P,N,_;return Q().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r.entityType||r.entityId||(null===(i=r.attributes)||void 0===i?void 0:i.length)>0){t.next=2;break}return t.abrupt("return",[]);case 2:if(a=[],u=[],r.queryType!==e.MULTITEMPORAL){t.next=58;break}(l=r.entitiesIds)&&l.length>0||(c="$DeviceMeasurement",r.variableMultitemp&&""!==r.variableMultitemp&&(c=r.variableMultitemp),l=(0,o.getTemplateSrv)().replace(c,void 0,"csv").split(",")),s=[],f=[],p=[],d=B(l),t.prev=11,d.s();case 13:if((y=d.n()).done){t.next=47;break}return h=y.value,t.next=17,this.request({queryType:e.ENTITY,attributes:["controlledProperty","depth","target"],entityId:h},n);case 17:return v=t.sent,m=v.data,f.push(b(m.controlledProperty)),g=b(m.depth),E=b(m.target),void 0!==g&&p.push("depth_"+g.toString()),void 0!==E&&p.push("place_"+E),void 0===g&&void 0===E&&p.push(""),t.next=27,this.request({queryType:e.TEMPORAL,entityId:h},n);case 27:w=t.sent,O=w.data;case 29:if(206!==w.status){t.next=44;break}return T=(T=(T=(T=w.headers.get("Content-Range").split(" ")[1]).split("/")[0]).split("-")).slice(3).join("-")+"Z",S=new Date(T),C=S.getTime(),void 0===n?n={from:C}:n.from=C,t.next=39,this.request({queryType:e.TEMPORAL,entityId:h},n);case 39:w=t.sent,A=w.data,s.push(A),t.next=29;break;case 44:s.push(O);case 45:t.next=13;break;case 47:t.next=52;break;case 49:t.prev=49,t.t0=t.catch(11),d.e(t.t0);case 52:return t.prev=52,d.f(),t.finish(52);case 55:I=0,x=B(s);try{for(x.s();!(P=x.n()).done;)N=P.value,Array.isArray(N)||(u=[N]),this.addDataToFrame(a,u,r,p[I],f[I],n),I++}catch(e){x.e(e)}finally{x.f()}case 58:if(r.queryType===e.MULTITEMPORAL){t.next=65;break}return t.next=61,this.request(r,n);case 61:_=t.sent,u=_.data,Array.isArray(u)||(u=[u]),this.addDataToFrame(a,u,r,"","",n);case 65:if(r.queryType!==e.GEO){t.next=67;break}return t.abrupt("return",[j.handleGeoResult(u,r.refId)]);case 67:if(r.queryType!==e.NODE_GRAPH){t.next=69;break}return t.abrupt("return",new R(this,r).handleGraphResult(u,4));case 69:return t.abrupt("return",a);case 70:case"end":return t.stop()}}),t,this,[[11,49,52,55]])}))),function(e,t){return d.apply(this,arguments)})},{key:"request",value:(p=H(Q().mark((function t(r,n){var a,u,l,c,s,f,p,d,y,v,m,b,g,E,w;return Q().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:u=(null==n?void 0:n.backend)||(0,o.getBackendSrv)(),c=[],t.t0=r.queryType,t.next=t.t0===e.TEMPORAL?5:t.t0===e.VERSION?12:t.t0===e.TYPES?14:t.t0===e.ATTRIBUTES?16:t.t0===e.GEO||t.t0===e.NODE_GRAPH||t.t0===e.ENTITY?19:23;break;case 5:return l="/temporal/entities",r.entityId&&(l+="/"+r.entityId),c.push("temporalValues"),r.aggrMethod&&(c.push("aggregatedValues"),l=h.appendQueryParam(l,"aggrMethod="+r.aggrMethod),r.aggrPeriodDuration&&(l=h.appendQueryParam(l,"aggrPeriodDuration="+r.aggrPeriodDuration))),t.abrupt("break",24);case 12:return l="/version",t.abrupt("break",24);case 14:return l="/types?details=true",t.abrupt("break",24);case 16:if(r.entityId){t.next=19;break}return l="/attributes",t.abrupt("break",24);case 19:return l="/entities",r.entityId&&(s=r.entityId.indexOf(",")>=0,l+=s?"?id="+r.entityId.split(",").map((function(e){return e.trim()})).filter((function(e){return e})).map(encodeURIComponent).join(","):"/"+(0,o.getTemplateSrv)().replace(r.entityId)),r.queryType===e.GEO?(null===(f=r.attributes)||void 0===f?void 0:f.length)>0?r.attributes.indexOf("location")<0&&r.attributes.push("location"):l=h.appendQueryParam(l,"q=location"):r.queryType===e.NODE_GRAPH&&(p=r.attributes||[],(d=function(e){var t;e&&(t=p).push.apply(t,q(new Set(Object.values(e).flatMap((function(e){return e})))))})(r.primaryNodeAttributes),d(r.secondaryNodeAttributes),d(r.arcColorNodeAttributes),(p=q(new Set(p))).length>0&&(r.attributes=p)),t.abrupt("break",24);case 23:throw new Error("Invalid query type "+r.queryType);case 24:return r.entityType&&(l=h.appendQueryParam(l,"type="+encodeURIComponent(r.entityType))),(null===(a=r.attributes)||void 0===a?void 0:a.length)>0&&(l=h.appendQueryParam(l,"attrs="+(null===(y=r.attributes)||void 0===y?void 0:y.map(encodeURIComponent).join(",")))),r.queryType===e.TEMPORAL&&(l=i.setTimeInterval(l,null==n?void 0:n.from,null==n?void 0:n.to)),r.georel&&(l=h.appendQueryParam(l,"georel="+encodeURIComponent(r.georel)),r.geometry&&(l=h.appendQueryParam(l,"geometry="+encodeURIComponent(r.geometry))),r.coordinates&&(l=h.appendQueryParam(l,"coordinates="+encodeURIComponent(r.coordinates))),r.geoproperty&&(l=h.appendQueryParam(l,"geoproperty="+encodeURIComponent(r.geoproperty)))),r.customQuery?(r.variableValue&&""!==r.variableValue&&(r.customQuery=r.customQuery+"%3BrefDevice==%22"+r.variableValue+"%22"),l=h.appendQueryParam(l,"q="+(0,o.getTemplateSrv)().replace(r.customQuery))):r.variableValue&&""!==r.variableValue&&(l=h.appendQueryParam(l,"q=refDevice==%22"+r.variableValue+"%22")),v=function(e,t,r){return isFinite(r)?h.appendQueryParam(e,encodeURIComponent(t)+"="+encodeURIComponent(r)):e},m=function(e,t,r){var n,o=B(r);try{for(o.s();!(n=o.n()).done;){var i=n.value;e=v(e,i,t[i])}}catch(e){o.e(e)}finally{o.f()}return e},n&&(l=m(l,n,["limit","offset","lastN"])),c.length>0&&(l=h.appendQueryParam(l,"options="+c.join(","))),b=r.queryType===e.VERSION?this.baseUrl.replace("/ngsi-ld/v1",""):r.queryType===e.TEMPORAL?this.timeseriesUrl:this.baseUrl,g=h.concatPaths(b,l),E={method:"GET",url:g,responseType:"json",headers:{Accept:"application/json"}},this.contextUrl&&r.queryType!==e.VERSION&&(E.headers={Link:this.contextLinkHeader,Accept:"application/ld+json"}),t.next=41,i.toPromise(u.fetch(E));case 41:return w=t.sent,t.abrupt("return",w);case 43:case"end":return t.stop()}}),t,this)}))),function(e,t){return p.apply(this,arguments)})},{key:"requestSimple",value:(s=H(Q().mark((function e(t,r){var n,a,u,l,c,s,f,p,d;return Q().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(null==r?void 0:r.backend)||(0,o.getBackendSrv)(),a=(0,o.getTemplateSrv)().replace(t,void 0,"csv"),u=a.split("?")[1],l=u.split("&").filter((function(e){return e.startsWith("q=")})),c=u.split("&").filter((function(e){return!e.startsWith("q=")})).join("&"),s="q=",f=a,1===l.length&&(l[0].substring(2).split("%3B").forEach((function(e){e.startsWith("controlledProperty==")?(s+="controlledProperty==",e.split("%22")[1].split(",").forEach((function(e){s+="%22"+e+"%22,"})),s=s.substring(0,s.length-1),s+="%3B"):s+=e+"%3B"})),s=s.substring(0,s.length-3),f=a.split("?")[0]+"?"+c+"&"+s),p={method:"GET",url:f,responseType:"json",headers:{Accept:"application/json"}},this.contextUrl&&(p.headers={Link:this.contextLinkHeader,Accept:"application/ld+json"}),e.next=12,i.toPromise(n.fetch(p));case 12:return d=e.sent,e.abrupt("return",d);case 14:case"end":return e.stop()}}),e,this)}))),function(e,t){return s.apply(this,arguments)})},{key:"testDatasource",value:(c=H(Q().mark((function t(){return Q().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.request({queryType:e.VERSION}));case 1:case"end":return t.stop()}}),t,this)}))),function(){return c.apply(this,arguments)})}],l=[{key:"setTimeInterval",value:function(e,t,r){var n=isFinite(t),o=isFinite(r);if(n||o){var i=n&&o?"between":n?"after":"before";e=h.appendQueryParam(e,"timerel="+i);var a=n?t:r;e=h.appendQueryParam(e,"timeAt="+new Date(a).toISOString()),n&&o&&(e=h.appendQueryParam(e,"endTimeAt="+new Date(r).toISOString()))}return e}},{key:"toPromise",value:function(e){return new Promise((function(t,r){e.subscribe({next:function(e){if(!e.ok){var n=e.status+": "+e.statusText;e.data&&(n+=" ("+e.data+")"),r("Failed to contact data source "+n)}t({data:e.data,status:e.status,headers:e.headers})},error:function(e){return r(e)}})}))}}],u&&K(a.prototype,u),l&&K(a,l),Object.defineProperty(a,"prototype",{writable:!1}),i}(t.DataSourceApi),ue=u(45),le=u.n(ue),ce=u(46);function se(e){return se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},se(e)}function fe(){return fe=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},fe.apply(this,arguments)}function pe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,ge(n.key),n)}}function de(e,t,r){return t=he(t),function(e,t){if(t&&("object"===se(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return ve(e)}(e,ye()?Reflect.construct(t,r||[],he(e).constructor):t.apply(e,r))}function ye(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(ye=function(){return!!e})()}function he(e){return he=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},he(e)}function ve(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function me(e,t){return me=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},me(e,t)}function be(e,t,r){return(t=ge(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ge(e){var t=function(e,t){if("object"!=se(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=se(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==se(t)?t:String(t)}ce.LegacyForms.SecretFormField;var Ee,we,Oe,Te,Se,Ce,Ae,je=ce.LegacyForms.FormField,Ie=function(e){function t(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return be(ve(e=de(this,t,[].concat(n))),"onUrlChange",(function(t){var r,n=e.props,o=n.options;(0,n.onOptionsChange)(fe({},o,{url:null===(r=t.currentTarget.value)||void 0===r?void 0:r.trim()}))})),be(ve(e),"onContextUrlChange",(function(t){var r,n=e.props,o=n.options;(0,n.onOptionsChange)(fe({},o,{jsonData:fe({},o.jsonData,{contextUrl:(null===(r=t.currentTarget.value)||void 0===r?void 0:r.trim())||""})}))})),be(ve(e),"onTimeseriesUrlChange",(function(t){var r,n=e.props,o=n.options;(0,n.onOptionsChange)(fe({},o,{jsonData:fe({},o.jsonData,{timeseriesUrl:(null===(r=t.currentTarget.value)||void 0===r?void 0:r.trim())||""})}))})),be(ve(e),"onAccessModeChange",(function(t){var r=e.props,n=r.options;(0,r.onOptionsChange)(fe({},n,{access:t.value||"proxy"}))})),be(ve(e),"onAuthStatusChange",(function(t){var r=e.props,n=r.options,o=r.onOptionsChange,i=fe({},n.jsonData,{authType:t?"oauth":void 0});o(fe({},n,{jsonData:i}))})),be(ve(e),"onClientIdChange",(function(t){if(t){var r=e.props,n=r.options,o=r.onOptionsChange,i=fe({},n.secureJsonData||{},{clientId:t});o(fe({},n,{secureJsonData:i}))}})),be(ve(e),"onClientSecretChange",(function(t){if(t){var r=e.props,n=r.options,o=r.onOptionsChange,i=fe({},n.secureJsonData||{},{clientSecret:t});o(fe({},n,{secureJsonData:i}))}})),be(ve(e),"onTokenServerChange",(function(t){var r=e.props,n=r.options,o=r.onOptionsChange,i=fe({},n.jsonData,{tokenUrl:t});o(fe({},n,{jsonData:i}))})),e}var r,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&me(e,t)}(t,e),r=t,(n=[{key:"render",value:function(){var e=this,t=this.props.options,r=t.jsonData,n=t.secureJsonFields,o=t.secureJsonData,i="oauth"===r.authType,a=i&&n.clientId&&n.clientSecret;return le().createElement("div",{className:"gf-form-group"},le().createElement("div",{className:"gf-form"},le().createElement(je,{label:"Context broker URL",labelWidth:10,inputWidth:20,onChange:this.onUrlChange,value:t.url||"",placeholder:"http://localhost:1026"})),le().createElement("div",{className:"gf-form"},le().createElement(je,{label:"Temporal broker URL",labelWidth:10,inputWidth:20,onChange:this.onTimeseriesUrlChange,value:r.timeseriesUrl||"",placeholder:"http://localhost:1026"})),le().createElement("div",{className:"gf-form"},le().createElement(je,{label:"Context URL",labelWidth:10,inputWidth:20,onChange:this.onContextUrlChange,value:r.contextUrl||"",placeholder:"http://localhost:80/ngsi-context.jsonld"})),le().createElement("div",{className:"gf-form-inline"},le().createElement("div",{className:"gf-form"},re||(re=le().createElement(ce.InlineFormLabel,{width:10,tooltip:"Select the access mode for the plugin."},"Access")),le().createElement(ce.Select,{options:[{value:"direct",title:"Send broker requests from the browser",label:"direct"},{value:"proxy",title:"Send broker requests via the backend",label:"proxy"}],value:t.access||"direct",onChange:this.onAccessModeChange,width:20}))),le().createElement("div",{className:"gf-form-inline"},le().createElement("div",{className:"gf-form"},le().createElement(ce.Checkbox,{checked:i,onChange:function(t){return e.onAuthStatusChange(t.currentTarget.checked)},label:"Authentication active?",title:"If checked, OAuth 2.0 authentication will be enabled for the datasource. Use with a context broker secured by means of OAuth."}))),i&&le().createElement(le().Fragment,null,le().createElement("div",{className:"gf-form-inline"},le().createElement("div",{className:"gf-form"},ne||(ne=le().createElement(ce.InlineFormLabel,{width:10,tooltip:"OAuth token server"},"OAuth token URL")),le().createElement(ce.Input,{value:r.tokenUrl||"",placeholder:"https://my.auth.server.com/v1/oauth/token",onChange:function(t){var r;return e.onTokenServerChange(null===(r=t.currentTarget.value)||void 0===r?void 0:r.trim())},title:"OAuth token server."}))),le().createElement("div",{className:"gf-form-inline"},le().createElement("div",{className:"gf-form"},oe||(oe=le().createElement(ce.InlineFormLabel,{width:10,tooltip:"OAuth client id. This must be configured in the authentication server, too."},"Client id")),le().createElement(ce.Input,{value:(null==o?void 0:o.clientId)||"",placeholder:a?"Value configured":"No client id configured yet",onChange:function(t){var r;return e.onClientIdChange(null===(r=t.currentTarget.value)||void 0===r?void 0:r.trim())},title:"OAuth client id. This must be configured in the authentication server.",type:"password"}))),le().createElement("div",{className:"gf-form-inline"},le().createElement("div",{className:"gf-form"},ie||(ie=le().createElement(ce.InlineFormLabel,{width:10,tooltip:"OAuth client secret. This must be configured in the authentication server, too."},"Client secret")),le().createElement(ce.Input,{value:(null==o?void 0:o.clientSecret)||"",placeholder:a?"Value configured":"No client secret configured yet",onChange:function(t){var r;return e.onClientSecretChange(null===(r=t.currentTarget.value)||void 0===r?void 0:r.trim())},title:"OAuth client secret. This must be configured in the authentication server, too.",type:"password"})))))}}])&&pe(r.prototype,n),o&&pe(r,o),Object.defineProperty(r,"prototype",{writable:!1}),t}(ue.PureComponent);function xe(e){return xe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},xe(e)}function Pe(e){return function(e){if(Array.isArray(e))return Ne(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return Ne(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ne(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ne(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _e(){return _e=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},_e.apply(this,arguments)}function ke(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Le(n.key),n)}}function Le(e){var t=function(e,t){if("object"!=xe(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=xe(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==xe(t)?t:String(t)}function Me(e,t,r){return t=Ge(t),function(e,t){if(t&&("object"===xe(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,De()?Reflect.construct(t,r||[],Ge(e).constructor):t.apply(e,r))}function De(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(De=function(){return!!e})()}function Ge(e){return Ge=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ge(e)}function Fe(e,t){return Fe=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Fe(e,t)}var Re=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Me(this,t,arguments)}var r,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Fe(e,t)}(t,e),r=t,(n=[{key:"attributeChanged",value:function(e,t,r){var n;if((t=(null===(n=t)||void 0===n?void 0:n.trim())||"")!==(r=r||"")){var o=this.props[e+"NodeAttributes"],i=""in(o=o?_e({},o):{})?o[""]:[],a=i.indexOf(r);if(a<0){if(!t)return;i.push(t)}else t?i.splice(a,1,t):i.splice(a,1);o[""]=Pe(new Set(i)),this.props.attributesChanged(e,o)}}},{key:"selector",value:function(e,t,r){var n=this;return le().createElement(ce.Segment,{value:ar.toOption(r||""),onChange:function(t){return n.attributeChanged(e,t.value,r)},options:t||[],inputMinWidth:6,allowCustomValue:!0})}},{key:"render",value:function(){var e=this,t=this.props,r=t.primaryNodeAttributes,n=t.secondaryNodeAttributes,o=t.arcColorNodeAttributes,i=t.primaryArcColor,a=t.secondaryArcColor,u=t.arcColorComplementLabel,l=t.proposedAttributes,c=(r&&""in r?r[""]:[]).map((function(e){return e.trim()})).filter((function(e){return e})),s=(n&&""in n?n[""]:[]).map((function(e){return e.trim()})).filter((function(e){return e})),f=(o&&""in o?o[""]:[]).map((function(e){return e.trim()})).filter((function(e){return e})),p=c.map((function(t){return e.selector("primary",l,t)}));p.push(this.selector("primary",l));var d=s.map((function(t){return e.selector("secondary",l,t)}));d.push(this.selector("secondary",l));var y=f.map((function(t){return e.selector("arcColor",l,t)}));y.push(this.selector("arcColor",l));var h=i||"green",v=a||"red";return le().createElement(le().Fragment,null,Ee||(Ee=le().createElement("h6",null,"Graph settings")),le().createElement("div",{className:"gf-form-inline"},le().createElement("div",{className:"gf-form"},we||(we=le().createElement(ce.InlineFormLabel,{width:12,tooltip:"Primary attributes for node values"},"Primary node properties")),p)),le().createElement("div",{className:"gf-form-inline"},le().createElement("div",{className:"gf-form"},Oe||(Oe=le().createElement(ce.InlineFormLabel,{width:12,tooltip:"Secondary attributes for node values; shown in a smaller font size below the primary values"},"Secondary node properties")),d)),le().createElement("div",{className:"gf-form-inline"},le().createElement("div",{className:"gf-form"},Te||(Te=le().createElement(ce.InlineFormLabel,{width:12,tooltip:"Attribute for coloring of node circles; must take values between 0 and 1."},"Arc color properties")),y)),le().createElement("div",{className:"gf-form-inline"},le().createElement("div",{className:"gf-form"},Se||(Se=le().createElement(ce.InlineFormLabel,{width:12,tooltip:"Label for the complement of the selected arc color property"},"Arc color complement")),le().createElement(ce.Input,{value:u,onChange:function(t){var r;return e.props.onArcColorComplementChanged((null===(r=t.currentTarget.value)||void 0===r?void 0:r.trim())||"")}}))),le().createElement("div",{className:"gf-form-inline"},le().createElement("div",{className:"gf-form"},Ce||(Ce=le().createElement(ce.InlineFormLabel,{width:12,tooltip:"Primary arc color. Only relevant if a property for the arc color is selected."},"Primary arc color"))," ",le().createElement(ce.ColorPicker,{color:h,onChange:function(t){return e.props.onColorChanged(!0,t)}}),"     ",Ae||(Ae=le().createElement(ce.InlineFormLabel,{width:12,tooltip:"Secondary arc color. Only relevant if a property for the arc color is selected."},"Secondary arc color"))," ",le().createElement(ce.ColorPicker,{color:v,onChange:function(t){return e.props.onColorChanged(!1,t)}}))))}}])&&ke(r.prototype,n),o&&ke(r,o),Object.defineProperty(r,"prototype",{writable:!1}),t}(ue.PureComponent);function qe(e){return qe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},qe(e)}function Ue(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Be(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Qe(n.key),n)}}function Ve(e,t,r){return t&&Be(e.prototype,t),r&&Be(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Ye(e,t,r){return(t=Qe(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Qe(e){var t=function(e,t){if("object"!=qe(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=qe(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==qe(t)?t:String(t)}var We,He,Ke,Je,$e,ze,Xe,Ze,et,tt=function(){function e(t){Ue(this,e),Ye(this,"_seconds",0),Ye(this,"_minutes",0),Ye(this,"_hours",0),Ye(this,"_days",0),Ye(this,"_months",0),Ye(this,"_years",0),this._build=t}return Ve(e,[{key:"setSeconds",value:function(t){return this._seconds=e._validate(t),this}},{key:"setMinutes",value:function(t){return this._minutes=e._validate(t),this}},{key:"setHours",value:function(t){return this._hours=e._validate(t),this}},{key:"setDays",value:function(t){return this._days=e._validate(t),this}},{key:"setMonths",value:function(t){return this._months=e._validate(t),this}},{key:"setYears",value:function(t){return this._years=e._validate(t),this}},{key:"build",value:function(){return this._build(this._seconds,this._minutes,this._hours,this._days,this._months,this._years)}}],[{key:"_validate",value:function(e){if(!isFinite(e))throw new Error("Invalid number "+e);return e}}]),e}(),rt=function(){function e(t,r,n,o,i,a){Ue(this,e),Ye(this,"_isEmpty",void 0),Ye(this,"_isTimePartEmpty",void 0),this._seconds=t,this._minutes=r,this._hours=n,this._days=o,this._months=i,this._years=a,this._isTimePartEmpty=[t,r,n].findIndex((function(e){return 0!==e}))<0,this._isEmpty=this._isTimePartEmpty&&[o,i,a].findIndex((function(e){return 0!==e}))<0}return Ve(e,[{key:"serialize",value:function(){if(this._isEmpty)return"PT0S";var e="P",t=function(t){0!==t[0]&&(e+=t[0]+t[1])};return[[this._years,"Y"],[this._months,"M"],[this._days,"D"]].forEach(t),this._isTimePartEmpty||(e+="T"),[[this._hours,"H"],[this._minutes,"M"],[this._seconds,"S"]].forEach(t),e}},{key:"seconds",value:function(){return this._seconds}},{key:"minutes",value:function(){return this._minutes}},{key:"hours",value:function(){return this._hours}},{key:"days",value:function(){return this._days}},{key:"months",value:function(){return this._months}},{key:"years",value:function(){return this._years}}],[{key:"builder",value:function(t){var r=new tt((function(t,r,n,o,i,a){return new e(t,r,n,o,i,a)}));return t&&(r.setSeconds(t._seconds),r.setMinutes(t._minutes),r.setHours(t._hours),r.setDays(t._days),r.setMonths(t._months),r.setYears(t._years)),r}},{key:"deserialize",value:function(t){if(t)try{if(!(t=t.toUpperCase()).startsWith("P"))return;var r=t.indexOf("T")>0,n=e.builder(),o=0,i=t.indexOf("Y",o);i>o&&(n.setYears(parseInt(t.substring(o+1,i),10)),o=i);var a=t.indexOf("M",o);a>o&&(!r||a<t.indexOf("T",o))&&(n.setMonths(parseInt(t.substring(o+1,a),10)),o=a);var u=t.indexOf("D",o);u>o&&(n.setDays(parseInt(t.substring(o+1,u),10)),o=u),r&&(o+=1);var l=t.indexOf("H",o);l>o&&(n.setHours(parseInt(t.substring(o+1,l),10)),o=l);var c=t.indexOf("M",o);c>o&&r&&c>t.indexOf("T",o)&&(n.setMinutes(parseInt(t.substring(o+1,c),10)),o=c);var s=t.indexOf("S",o);return s>o&&(n.setSeconds(parseInt(t.substring(o+1,s),10)),o=s),n.build()}catch(e){return}}}]),e}();function nt(e){return nt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},nt(e)}function ot(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,ct(n.key),n)}}function it(e,t,r){return t=ut(t),function(e,t){if(t&&("object"===nt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,at()?Reflect.construct(t,r||[],ut(e).constructor):t.apply(e,r))}function at(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(at=function(){return!!e})()}function ut(e){return ut=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ut(e)}function lt(e,t){return lt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},lt(e,t)}function ct(e){var t=function(e,t){if("object"!=nt(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=nt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==nt(t)?t:String(t)}var st,ft,pt,dt,yt,ht,vt,mt,bt,gt,Et,wt=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),it(this,t,arguments)}var r,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&lt(e,t)}(t,e),r=t,(n=[{key:"methodsChanged",value:function(e){this.props.onAggregationMethodChanged(e.map((function(e){return e.value})).filter((function(e){return e})))}},{key:"periodChanged",value:function(e,t,r){var n=parseInt(r||"",10);isFinite(n)&&(e=t.bind(e)(n),this.props.onAggregationPeriodChanged(e.build()))}},{key:"render",value:function(){var e=this,r=this.props,n=r.aggrMethod,o=r.aggrPeriodDuration,i=(n||"").split(",").map((function(e){return e.trim()})).map(c).filter((function(e){return e})),a=rt.deserialize(o)||rt.builder().build(),u=rt.builder(a),l=[le().createElement("div",{className:"gf-form-inline",key:"aggrmethod"},le().createElement("div",{className:"gf-form"},We||(We=le().createElement(ce.InlineFormLabel,{width:12,tooltip:"Temporal aggregation of values. Deselect all to retrieve the original timeseries."},"Aggregation method")),le().createElement(ce.MultiSelect,{options:t.AGGREGATION_METHODS,value:i,onChange:this.methodsChanged.bind(this),width:20})))];return i.length>0&&l.push(le().createElement("div",{className:"gf-form-inline",key:"aggrperiod"},le().createElement("div",{className:"gf-form"},He||(He=le().createElement(ce.InlineFormLabel,{width:12,tooltip:"Temporal aggregation duration. Set all entries to 0 to aggregate over the whole time interval."},"Aggregation period")),le().createElement(ce.Input,{value:a.years(),onChange:function(t){var r,n;return e.periodChanged(u,u.setYears,null==t||null===(r=t.currentTarget)||void 0===r||null===(n=r.value)||void 0===n?void 0:n.trim())},type:"number",width:5,title:"Years"}),Ke||(Ke=le().createElement(ce.InlineFormLabel,{width:2},"Y")),le().createElement(ce.Input,{value:a.months(),onChange:function(t){var r,n;return e.periodChanged(u,u.setMonths,null==t||null===(r=t.currentTarget)||void 0===r||null===(n=r.value)||void 0===n?void 0:n.trim())},type:"number",width:5,title:"Months"}),Je||(Je=le().createElement(ce.InlineFormLabel,{width:2},"M")),le().createElement(ce.Input,{value:a.days(),onChange:function(t){var r,n;return e.periodChanged(u,u.setDays,null==t||null===(r=t.currentTarget)||void 0===r||null===(n=r.value)||void 0===n?void 0:n.trim())},type:"number",width:5,title:"Days"}),$e||($e=le().createElement(ce.InlineFormLabel,{width:2},"DT")),le().createElement(ce.Input,{value:a.hours(),onChange:function(t){var r,n;return e.periodChanged(u,u.setHours,null==t||null===(r=t.currentTarget)||void 0===r||null===(n=r.value)||void 0===n?void 0:n.trim())},type:"number",width:5,title:"Hours"}),ze||(ze=le().createElement(ce.InlineFormLabel,{width:2},"H")),le().createElement(ce.Input,{value:a.minutes(),onChange:function(t){var r,n;return e.periodChanged(u,u.setMinutes,null==t||null===(r=t.currentTarget)||void 0===r||null===(n=r.value)||void 0===n?void 0:n.trim())},type:"number",width:5,title:"Minutes"}),Xe||(Xe=le().createElement(ce.InlineFormLabel,{width:2},"M")),le().createElement(ce.Input,{value:a.seconds(),onChange:function(t){var r,n;return e.periodChanged(u,u.setSeconds,null==t||null===(r=t.currentTarget)||void 0===r||null===(n=r.value)||void 0===n?void 0:n.trim())},type:"number",width:5,title:"Seconds"}),Ze||(Ze=le().createElement(ce.InlineFormLabel,{width:2},"S"))))),le().createElement(le().Fragment,null,et||(et=le().createElement("h6",null,"Temporal aggregation")),l)}}])&&ot(r.prototype,n),o&&ot(r,o),Object.defineProperty(r,"prototype",{writable:!1}),t}(ue.PureComponent);function Ot(e){return Ot="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ot(e)}function Tt(){return Tt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Tt.apply(this,arguments)}function St(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Pt(n.key),n)}}function Ct(e,t,r){return t=jt(t),function(e,t){if(t&&("object"===Ot(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,At()?Reflect.construct(t,r||[],jt(e).constructor):t.apply(e,r))}function At(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(At=function(){return!!e})()}function jt(e){return jt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},jt(e)}function It(e,t){return It=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},It(e,t)}function xt(e,t,r){return(t=Pt(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Pt(e){var t=function(e,t){if("object"!=Ot(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=Ot(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Ot(t)?t:String(t)}st=wt,ft="AGGREGATION_METHODS",pt=[{value:i.TOTAL_COUNT,label:"Total count",description:"Number of points",title:"Number of points"},{value:i.DISTINCT_COUNT,label:"Distinct count",description:"Number of distinct values",title:"Number of distinct values"},{value:i.SUM,label:"Sum",description:"",title:""},{value:i.AVERAGE,label:"Average",description:"",title:""},{value:i.MIN,label:"Min",description:"",title:""},{value:i.MAX,label:"Max",description:"",title:""},{value:i.STANDARD_DEVIATION,label:"Standard deviation",description:"",title:""},{value:i.SUM_SQUARE,label:"Sum square",description:"Sum of squared valued",title:"Sum of squared valued"}],(ft=ct(ft))in st?Object.defineProperty(st,ft,{value:pt,enumerable:!0,configurable:!0,writable:!0}):st[ft]=pt,function(e){e.MAX_DISTANCE="maxDistance",e.MIN_DISTANCE="minDistance"}(Et||(Et={}));var Nt,_t,kt,Lt,Mt,Dt,Gt,Ft,Rt,qt,Ut,Bt=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Ct(this,t,arguments)}var r,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&It(e,t)}(t,e),r=t,n=[{key:"georelChanged",value:function(e){e||(e=a.NONE);var r=Tt({},this.props,{georel:t.buildGeorel(this.props.georel,{newType:e}),onGeoChanged:void 0});this.props.onGeoChanged(r)}},{key:"distanceTypeChanged",value:function(e){e||(e=Et.MAX_DISTANCE);var r=Tt({},this.props,{georel:t.buildGeorel(this.props.georel,{newDistanceType:e}),onGeoChanged:void 0});this.props.onGeoChanged(r)}},{key:"distanceChanged",value:function(e){e>0||(e=2e4);var r=Tt({},this.props,{georel:t.buildGeorel(this.props.georel,{newDistance:e}),onGeoChanged:void 0});this.props.onGeoChanged(r)}},{key:"geometryChanged",value:function(e){var t=Tt({},this.props,{geometry:e,onGeoChanged:void 0});this.props.onGeoChanged(t)}},{key:"geopropertyChanged",value:function(e){var t=Tt({},this.props,{geoproperty:e,onGeoChanged:void 0});this.props.onGeoChanged(t)}},{key:"coordinatesChanged",value:function(e){var t=Tt({},this.props,{coordinates:e,onGeoChanged:void 0});this.props.onGeoChanged(t)}},{key:"render",value:function(){var e=this,r=this.props,n=r.georel,o=r.geometry,i=r.coordinates,u=r.geoproperty,l=s(n),c=le().createElement(le().Fragment,null,dt||(dt=le().createElement("h6",null,"Geo filters")),le().createElement("div",{className:"gf-form-inline"},le().createElement("div",{className:"gf-form"},yt||(yt=le().createElement(ce.InlineFormLabel,{width:12,tooltip:"Specify the geo filter to apply (georel property)"},"Geo relation filter")),le().createElement(ce.Select,{options:t.GEOREL_OPTIONS,value:l,onChange:function(t){return e.georelChanged(null==t?void 0:t.value)},width:20}))));if(l===a.NONE)return c;var f=ht||(ht=le().createElement(le().Fragment,null));if(l===a.NEAR){var p=(null==n?void 0:n.indexOf("min"))>0,d=(null==n?void 0:n.indexOf("=="))>0?parseFloat(null==n?void 0:n.substring((null==n?void 0:n.lastIndexOf("=="))+2)):2e4;d>0||(d=2e4),f=le().createElement(le().Fragment,null,le().createElement("div",{className:"gf-form-inline"},le().createElement("div",{className:"gf-form"},vt||(vt=le().createElement(ce.InlineFormLabel,{width:12,tooltip:"Distance in meters from specified center"},"Distance (m)")),le().createElement(ce.Input,{value:d,onChange:function(t){var r,n;return e.distanceChanged(parseFloat(null===(r=t.currentTarget)||void 0===r||null===(n=r.value)||void 0===n?void 0:n.trim()))},type:"number",width:12,title:"Distance in meters"}),le().createElement(ce.Select,{options:t.DISTANCE_OPTIONS,value:p?Et.MIN_DISTANCE:Et.MAX_DISTANCE,onChange:function(t){return e.distanceTypeChanged(null==t?void 0:t.value)},width:20}))))}return le().createElement(le().Fragment,null,c,f,le().createElement("div",{className:"gf-form-inline"},le().createElement("div",{className:"gf-form"},mt||(mt=le().createElement(ce.InlineFormLabel,{width:12,tooltip:"Specify the geo filter to apply (georel property)"},"Geo relation filter")),le().createElement(ce.Segment,{value:o||"Point",onChange:function(t){return e.geometryChanged(null==t?void 0:t.value)},options:t.GEOMETRY_OPTIONS,inputMinWidth:12,allowCustomValue:!0}))),le().createElement("div",{className:"gf-form-inline"},le().createElement("div",{className:"gf-form"},bt||(bt=le().createElement(ce.InlineFormLabel,{width:12,tooltip:"Specify coordinates "},"Coordinates")),le().createElement(ce.Input,{value:i||"",onChange:function(t){var r,n;return e.coordinatesChanged(null===(r=t.currentTarget)||void 0===r||null===(n=r.value)||void 0===n?void 0:n.trim())},width:12,placeholder:"[8,40]",type:"text"}))),le().createElement("div",{className:"gf-form-inline"},le().createElement("div",{className:"gf-form"},gt||(gt=le().createElement(ce.InlineFormLabel,{width:12,tooltip:"Specify the geo property (geoproperty)"},"Geo property")),le().createElement(ce.Segment,{value:u||"location",onChange:function(t){return e.geopropertyChanged(null==t?void 0:t.value)},options:t.GEOPROPERTY_OPTIONS,inputMinWidth:12,allowCustomValue:!0}))))}}],o=[{key:"buildGeorel",value:function(e,t){var r=s(t.newType||e);if(r===a.NONE)return"";if(r!==a.NEAR)return r.valueOf();var n=t.newDistance;if(void 0===n){var o,i=(null==e?void 0:e.lastIndexOf("=="))||-1;n=i>0?parseFloat(null==e||null===(o=e.substring(i+2))||void 0===o?void 0:o.trim()):2e4}n>0||(n=2e4);var u=t.newDistanceType;if(void 0===u){var l=(null==e?void 0:e.indexOf(";"))||-1,c=(null==e?void 0:e.lastIndexOf("=="))||-1;u=l>0&&c>0&&"mindistance"===(null==e?void 0:e.substring(l+1,c).trim().toLowerCase())?Et.MIN_DISTANCE:Et.MAX_DISTANCE}return"near;"+u.valueOf()+"=="+n}}],n&&St(r.prototype,n),o&&St(r,o),Object.defineProperty(r,"prototype",{writable:!1}),t}(ue.PureComponent);function Vt(e){return Vt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Vt(e)}function Yt(e){return function(e){if(Array.isArray(e))return Ht(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Wt(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Qt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i,a,u=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=i.call(r)).done)&&(u.push(n.value),u.length!==t);l=!0);}catch(e){c=!0,o=e}finally{try{if(!l&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw o}}return u}}(e,t)||Wt(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Wt(e,t){if(e){if("string"==typeof e)return Ht(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Ht(e,t):void 0}}function Ht(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Kt(){Kt=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var i=t&&t.prototype instanceof m?t:m,a=Object.create(i.prototype),u=new P(n||[]);return o(a,"_invoke",{value:A(e,r,u)}),a}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var p="suspendedStart",d="suspendedYield",y="executing",h="completed",v={};function m(){}function b(){}function g(){}var E={};c(E,a,(function(){return this}));var w=Object.getPrototypeOf,O=w&&w(w(N([])));O&&O!==r&&n.call(O,a)&&(E=O);var T=g.prototype=m.prototype=Object.create(E);function S(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function C(e,t){function r(o,i,a,u){var l=f(e[o],e,i);if("throw"!==l.type){var c=l.arg,s=c.value;return s&&"object"==Vt(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,a,u)}),(function(e){r("throw",e,a,u)})):t.resolve(s).then((function(e){c.value=e,a(c)}),(function(e){return r("throw",e,a,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return i=i?i.then(o,o):o()}})}function A(t,r,n){var o=p;return function(i,a){if(o===y)throw new Error("Generator is already running");if(o===h){if("throw"===i)throw a;return{value:e,done:!0}}for(n.method=i,n.arg=a;;){var u=n.delegate;if(u){var l=j(u,n);if(l){if(l===v)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===p)throw o=h,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=y;var c=f(t,r,n);if("normal"===c.type){if(o=n.done?h:d,c.arg===v)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(o=h,n.method="throw",n.arg=c.arg)}}}function j(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,j(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function I(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function x(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(I,this),this.reset(!0)}function N(t){if(t||""===t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return i.next=i}}throw new TypeError(Vt(t)+" is not iterable")}return b.prototype=g,o(T,"constructor",{value:g,configurable:!0}),o(g,"constructor",{value:b,configurable:!0}),b.displayName=c(g,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,c(e,l,"GeneratorFunction")),e.prototype=Object.create(T),e},t.awrap=function(e){return{__await:e}},S(C.prototype),c(C.prototype,u,(function(){return this})),t.AsyncIterator=C,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new C(s(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},S(T),c(T,l,"Generator"),c(T,a,(function(){return this})),c(T,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=N,P.prototype={constructor:P,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(x),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return u.type="throw",u.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],u=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var l=n.call(a,"catchLoc"),c=n.call(a,"finallyLoc");if(l&&c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),x(r),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;x(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:N(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),v}},t}function Jt(e,t,r,n,o,i,a){try{var u=e[i](a),l=u.value}catch(e){return void r(e)}u.done?t(l):Promise.resolve(l).then(n,o)}function $t(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){Jt(i,n,o,a,u,"next",e)}function u(e){Jt(i,n,o,a,u,"throw",e)}a(void 0)}))}}function zt(){return zt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},zt.apply(this,arguments)}function Xt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,ir(n.key),n)}}function Zt(e,t,r){return t=tr(t),function(e,t){if(t&&("object"===Vt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return rr(e)}(e,er()?Reflect.construct(t,r||[],tr(e).constructor):t.apply(e,r))}function er(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(er=function(){return!!e})()}function tr(e){return tr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},tr(e)}function rr(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function nr(e,t){return nr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},nr(e,t)}function or(e,t,r){return(t=ir(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ir(e){var t=function(e,t){if("object"!=Vt(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=Vt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Vt(t)?t:String(t)}xt(Bt,"DISTANCE_OPTIONS",[{value:Et.MAX_DISTANCE,label:"max radius",description:"Maximum distance from specified point",title:"Maximum distance from specified point (the default)"},{value:Et.MIN_DISTANCE,label:"min radius",description:"Minimum distance from specified point",title:"Minimum distance from specified point "}]),xt(Bt,"GEOREL_OPTIONS",[{value:a.NONE,label:"none",description:"Disable geo filters",title:"Disable geo filters"},{value:a.NEAR,label:"near",description:"Specify a radius for the included points",title:"Specify a radius for the included points"},{value:a.EQUALS,label:"equals",description:"Geometries must match exactly",title:"Geometries must match exactly"},{value:a.DISJOINT,label:"disjoint",description:"Geometry must lie outside the specified one",title:"Geometry must lie outside the specified one"},{value:a.INTERSECTS,label:"intersects",description:"Geometry must intersect the specified one; shared borders are sufficient",title:"Geometry must intersect the specified one; shared borders are sufficient"},{value:a.WITHIN,label:"within",description:"Geometries must lie within the specified one",title:"Geometries must lie within the specified one"},{value:a.CONTAINS,label:"contains",description:"Geometries must contain the specified one",title:"Geometries must contain the specified one"},{value:a.OVERLAPS,label:"overlaps",description:"Geometry must overlap the specified one; does not match on shared borders",title:"Geometry must overlap the specified one; does not match on shared borders"}]),xt(Bt,"GEOMETRY_OPTIONS",[{value:"Point",label:"Point",description:"A point specified by longitude and latitude",title:"A point specified by longitude and latitude"},{value:"LineString",label:"LineString",description:"A line string specified by an array of points",title:"A line string specified by an array of points"},{value:"Polygon",label:"Polygon",description:"A polygon specified by an array of line strings",title:"A polygon specified by an array of line strings"}]),xt(Bt,"GEOPROPERTY_OPTIONS",[{value:"location",label:"location",description:"The location of an entity (default)",title:"The location of an entity (default)"},{value:"observationSpace",label:"observationSpace",description:"The location observed by an entity",title:"The location observed by an entity"},{value:"operationSpace",label:"operationSpace",description:"The location in which an entity is active",title:"The location in which an entity is active"}]);var ar=function(t){function r(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),or(rr(t=Zt(this,r,[e])),"onEntityTypeChange",(function(e){var n,o=t.props,i=o.onChange,a=o.query,u=o.datasource,l=(null===(n=e.value)||void 0===n?void 0:n.trim())||"";l===r.EMPTY_OPTION_ID&&(l=""),t.loadEntities(u,l),i(zt({},a,l?{entityType:l,entityId:void 0,attributes:void 0}:{entityType:l}))})),or(rr(t),"onAttributeChange",(function(e){var n=t.props;(0,n.onChange)(zt({},n.query,{attributes:e.map((function(e){var t,n=(null===(t=e.value)||void 0===t?void 0:t.trim())||"";return n===r.EMPTY_OPTION_ID&&(n=""),n})).filter((function(e){return e}))}))})),or(rr(t),"onEntytiesChange",(function(e){var n=t.props;(0,n.onChange)(zt({},n.query,{entitiesIds:e.map((function(e){var t,n=(null===(t=e.value)||void 0===t?void 0:t.trim())||"";return n===r.EMPTY_OPTION_ID&&(n=""),n}))}))})),or(rr(t),"onQueryTypeChange",(function(e){var r,n=t.props;(0,n.onChange)(zt({},n.query,{queryType:(null==e||null===(r=e.value)||void 0===r?void 0:r.valueOf())||""}))})),or(rr(t),"onEntityIdChange",(function(e){var n,o=(null===(n=e.value)||void 0===n?void 0:n.trim())||"";o===r.EMPTY_OPTION_ID&&(o="");var i=t.props,a=i.onChange,u=i.query,l=i.datasource;t.loadAttributes(l,o),a(zt({},u,o?{entityId:o,attributes:[]}:{entityId:o}))})),or(rr(t),"onCustomQueryChange",(function(e){var r=t.props;(0,r.onChange)(zt({},r.query,{customQuery:(null==e?void 0:e.trim())||""}))})),or(rr(t),"onVariableMultitempChange",(function(e){var r=t.props;(0,r.onChange)(zt({},r.query,{variableMultitemp:(null==e?void 0:e.trim())||""}))})),or(rr(t),"onLongEntityNameChange",(function(e){var r=t.props;(0,r.onChange)(zt({},r.query,{useLongEntityName:e.currentTarget.checked}))})),or(rr(t),"onGraphAttributesChanged",(function(e,r){var n=t.props;(0,n.onChange)(zt({},n.query,or({},e+"NodeAttributes",r)))})),or(rr(t),"onGraphColorChanged",(function(e,r){var n=t.props;(0,n.onChange)(zt({},n.query,or({},(e?"primary":"secondary")+"ArcColor",r)))})),or(rr(t),"onArcColorComplementChanged",(function(e){var r=t.props;(0,r.onChange)(zt({},r.query,{arcColorComplementLabel:e}))})),or(rr(t),"onAggregationMethodChanged",(function(e){var r=t.props;(0,r.onChange)(zt({},r.query,{aggrMethod:e.length>0?e.map((function(e){return e.valueOf()})).join(","):void 0}))})),or(rr(t),"onAggregationPeriodChanged",(function(e){var r=t.props;(0,r.onChange)(zt({},r.query,{aggrPeriodDuration:e.serialize()}))})),or(rr(t),"onGeoChanged",(function(e){var r=t.props;(0,r.onChange)(zt({},r.query,{georel:null==e?void 0:e.georel,geometry:(null==e?void 0:e.geometry)||"Point",coordinates:null==e?void 0:e.coordinates,geoproperty:(null==e?void 0:e.geoproperty)||"location"}))})),t.loadData(),t}var i,a,u,l,c;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&nr(e,t)}(r,t),i=r,a=[{key:"loadData",value:function(){var t=this,r=this.props.datasource.request({queryType:e.TYPES}).then((function(e){var r=e.data;return r.forEach((function(e){var t,r=null===(t=e.typeName)||void 0===t?void 0:t.lastIndexOf(".");e.shortName=r>=0&&r<e.typeName.length-1?e.typeName.substring(r+1):e.typeName})),new Promise((function(e){return t.setState({types:r},(function(){return e(r)}))}))})),n=this.props.datasource.request({queryType:e.ATTRIBUTES}).then((function(e){return new Promise((function(r){return t.setState({attributes:e.data.attributeList},r)}))})),o=r.then(function(){var e=$t(Kt().mark((function e(r){var n;return Kt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.length>25&&(r=r.filter((function(e,t){return t<25}))),n=r.length>0?r.map((function(e){return e.typeName})).join(","):void 0,e.abrupt("return",t.loadEntities(t.props.datasource,n,100));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());return Promise.all([r,n,o])}},{key:"loadEntities",value:(c=$t(Kt().mark((function t(r,n,i){var a,u,l,c,s,f,p,d,y,h,v,m,b=this;return Kt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n){t.next=2;break}return t.abrupt("return");case 2:if(null===(a=this.state)||void 0===a||!a.entityIdsByType||!(n in this.state.entityIdsByType)){t.next=5;break}return t.abrupt("return");case 5:return t.next=7,r.request({queryType:e.ENTITY,entityType:n},{limit:i||25});case 7:return c=t.sent,s=c.data,(f=(0,o.getTemplateSrv)().replace("$Device")).includes("urn:ngsi-ld:")||(f=""),t.next=13,r.request({queryType:e.ENTITY,variableValue:f},{limit:i||25});case 13:if(c=t.sent,p=c.data,d=p.map((function(e){return e.id})),0!==s.length){t.next=18;break}return t.abrupt("return");case 18:return(y=null!==(u=this.state)&&void 0!==u&&u.entityIdsByType?zt({},this.state.entityIdsByType):{})[n]=s.map((function(e){return e.id})),h=null!==(l=this.state)&&void 0!==l&&l.attributesByEntityId?zt({},this.state.attributesByEntityId):{},v=function(e){return Object.entries(e).filter((function(e){var t=Qt(e,2),r=t[0],n=t[1];return!(E.indexOf(r)>=0||!n.value||!isFinite(n.value))})).map((function(e){var t=Qt(e,2),r=t[0];return t[1],r}))},m=Object.fromEntries(s.map((function(e){return[e.id,v(e)]}))),Object.assign(h,m),t.abrupt("return",new Promise((function(e){return b.setState({entityIdsByType:y,attributesByEntityId:h,entitiesIdsVariable:d},e)})));case 25:case"end":return t.stop()}}),t,this)}))),function(e,t,r){return c.apply(this,arguments)})},{key:"loadAttributes",value:(l=$t(Kt().mark((function t(r,n){var o,i,a,u,l,c;return Kt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n){t.next=2;break}return t.abrupt("return");case 2:if(null===(o=this.state)||void 0===o||!o.attributesByEntityId||!(n in this.state.attributesByEntityId)){t.next=5;break}return t.abrupt("return");case 5:return t.next=7,r.request({queryType:e.ENTITY,entityId:n});case 7:if(a=t.sent,u=a.data){t.next=11;break}return t.abrupt("return");case 11:if(0!==(l=Object.keys(u).filter((function(e){return E.indexOf(e)<0}))).length){t.next=14;break}return t.abrupt("return");case 14:(c=null!==(i=this.state)&&void 0!==i&&i.attributesByEntityId?zt({},this.state.attributesByEntityId):{})[n]=l,this.setState({attributesByEntityId:c});case 17:case"end":return t.stop()}}),t,this)}))),function(e,t){return l.apply(this,arguments)})},{key:"getEntityTypes",value:function(){var e;if(null===(e=this.state)||void 0===e||!e.types)return[];var t=this.state.types.map((function(e){return{id:e.typeName,name:e.shortName,description:e.typeName}})).map(r.toOption).sort();return t.unshift(r.EMPTY_OPTION),t}},{key:"getEntitiesIdsVariable",value:function(){var e;if(null===(e=this.state)||void 0===e||!e.entitiesIdsVariable)return[];var t=this.state.entitiesIdsVariable.map(r.toOption);return t.length>0&&t.unshift(r.EMPTY_OPTION),t}},{key:"getEntityIds",value:function(e){var t,n;if(null===(t=this.state)||void 0===t||!t.entityIdsByType)return[];if(!e){var o=[],i=Object.values(this.state.entityIdsByType),a=i.reduce((function(e,t){return Math.max(e,t.length)}),0),u=0;e:for(var l=0;l<a;l++)for(var c=0;c<i.length;c++){var s=i[c];if(l<s.length&&(o.push(r.toOption(s[l])),u++>50))break e}return o.length>0&&o.unshift(r.EMPTY_OPTION),o}if(null!==(n=this.state)&&void 0!==n&&n.entityIdsByType&&e in this.state.entityIdsByType){var f=this.state.entityIdsByType[e].map(r.toOption);return f.length>0&&f.unshift(r.EMPTY_OPTION),f}return[]}},{key:"getAttributes",value:function(e,t,n,o){var i=this.getAttributesInternal(e,t,n);return o&&i.length>0&&i.unshift(r.EMPTY_OPTION),i}},{key:"getAttributesInternal",value:function(t,n,o){var i,a;if(o===e.NODE_GRAPH){var u,l,c;if((null===(u=this.state)||void 0===u||null===(l=u.attributes)||void 0===l?void 0:l.length)>0)return this.state.attributes.map(r.toOption).sort();if(null!==(c=this.state)&&void 0!==c&&c.attributesByEntityId)return Yt(new Set(Object.values(this.state.attributesByEntityId).flatMap((function(e){return e})))).map(r.toOption).sort()}if(n&&null!==(i=this.state)&&void 0!==i&&i.attributesByEntityId&&n in this.state.attributesByEntityId)return this.state.attributesByEntityId[n].map(r.toOption).sort();if(t){var s,f,p=t?null===(s=this.state)||void 0===s||null===(f=s.types)||void 0===f?void 0:f.find((function(e){return e.typeName===t})):void 0;if(p)return p.attributeNames.map(r.toOption).sort()}return((null===(a=this.state)||void 0===a?void 0:a.attributes)||[]).map(r.toOption).sort()}},{key:"render",value:function(){var t=this,o=n()(this.props.query,f),i=o.entityId,a=o.entityType,u=o.entitiesIds,l=o.attributes,c=o.useLongEntityName,s=o.queryType,p=o.customQuery,d=o.variableMultitemp,y=function(t){if(t)switch(t.toLowerCase()){case"entity":case"entities":return e.ENTITY;case"multitemporal":return e.MULTITEMPORAL;case"temporal":case"timseries":return e.TEMPORAL;case"geo":return e.GEO;case"type":case"types":return e.TYPES;case"version":return e.VERSION;case"attribute":case"attributes":return e.ATTRIBUTES;case"graph":case"nodegraph":case"node_graph":return e.NODE_GRAPH;default:return}}(s),h=_t||(_t=le().createElement(le().Fragment,null));if(s===e.NODE_GRAPH){var v=o.primaryNodeAttributes,m=o.secondaryNodeAttributes,b=o.arcColorNodeAttributes,g=o.primaryArcColor,E=o.secondaryArcColor,w=o.arcColorComplementLabel;h=le().createElement(Re,{primaryNodeAttributes:v,secondaryNodeAttributes:m,arcColorNodeAttributes:b,arcColorComplementLabel:w,primaryArcColor:g,secondaryArcColor:E,proposedAttributes:this.getAttributes(a,i,s,!0),attributesChanged:this.onGraphAttributesChanged,onColorChanged:this.onGraphColorChanged,onArcColorComplementChanged:this.onArcColorComplementChanged})}var O=kt||(kt=le().createElement(le().Fragment,null));if(s===e.TEMPORAL){var T=o.aggrMethod,S=o.aggrPeriodDuration;O=le().createElement(wt,{aggrMethod:T,aggrPeriodDuration:S,onAggregationMethodChanged:this.onAggregationMethodChanged,onAggregationPeriodChanged:this.onAggregationPeriodChanged})}var C=o.georel,A=o.geometry,j=o.geoproperty,I=o.coordinates,x=le().createElement(Bt,{georel:C,geometry:A,geoproperty:j,coordinates:I,onGeoChanged:this.onGeoChanged});return le().createElement("div",{style:{display:"flex",columnGap:"1.5em",rowGap:"1em",flexWrap:"wrap"}},le().createElement("div",null,Lt||(Lt=le().createElement("h6",null,"Basic settings and filters")),le().createElement("div",{className:"gf-form-inline"},le().createElement("div",{className:"gf-form"},Mt||(Mt=le().createElement(ce.InlineFormLabel,{width:12,tooltip:"Query type"},"Query type")),le().createElement(ce.Select,{options:r.QUERY_TYPES,value:y,onChange:this.onQueryTypeChange,width:20}))),le().createElement("div",{className:"gf-form-inline"},le().createElement("div",{className:"gf-form"},Dt||(Dt=le().createElement(ce.InlineFormLabel,{width:12,tooltip:"Select the entity type"},"Entity type")),le().createElement(ce.Segment,{value:a||"",onChange:this.onEntityTypeChange,options:this.getEntityTypes(),inputMinWidth:12,allowCustomValue:!0}))),le().createElement("div",{className:"gf-form-inline"},le().createElement("div",{className:"gf-form"},Gt||(Gt=le().createElement(ce.InlineFormLabel,{width:12,tooltip:"Select the entity id"},"Entity id")),le().createElement(ce.Segment,{value:i||"",onChange:this.onEntityIdChange,options:this.getEntityIds(a),inputMinWidth:12,allowCustomValue:!0}))),le().createElement("div",{className:"gf-form-inline"},le().createElement("div",{className:"gf-form"},Ft||(Ft=le().createElement(ce.InlineFormLabel,{width:12,tooltip:"Attributes to include"},"Attributes")),le().createElement(ce.MultiSelect,{options:this.getAttributes(a,i,y),value:l,onChange:this.onAttributeChange,width:20}))),le().createElement("div",{className:"gf-form-inline"},le().createElement("div",{className:"gf-form"},Rt||(Rt=le().createElement(ce.InlineFormLabel,{width:12,tooltip:"A query string conforming to the NGSI-LD query language, such as speed>50;brandName!='Mercedes'"},"Custom query")),le().createElement(ce.Input,{value:p||"",onChange:function(e){return t.onCustomQueryChange(e.currentTarget.value)},type:"string",placeholder:'speed>50;brandName!="Mercedes"',width:20}))),le().createElement("div",{className:"gf-form-inline"},le().createElement("div",{className:"gf-form"},qt||(qt=le().createElement(ce.InlineFormLabel,{width:12,tooltip:"Entities to include"},"Entities Multitemp")),le().createElement(ce.Select,{options:this.getEntitiesIdsVariable(),value:u,onChange:this.onEntytiesChange,isMulti:!0,isClearable:!0,closeMenuOnSelect:!1,placeholder:"Selecciona o escribe..."}))),le().createElement("div",{className:"gf-form-inline"},le().createElement("div",{className:"gf-form"},Ut||(Ut=le().createElement(ce.InlineFormLabel,{width:12,tooltip:"The Grafana Variable to use when no entities multitemp are selected"},"Variable Multitemp")),le().createElement(ce.Input,{value:d||"",onChange:function(e){return t.onVariableMultitempChange(e.currentTarget.value)},type:"string",placeholder:"$VariableName",width:20}))),le().createElement("div",{className:"gf-form-inline"},le().createElement("div",{className:"gf-form"},le().createElement(ce.Checkbox,{value:c||!1,onChange:this.onLongEntityNameChange,label:"Long entity names",description:"Show the fully qualified entity name?"})))),le().createElement("div",null,x),le().createElement("div",null,h),le().createElement("div",null,O))}}],u=[{key:"toOption",value:function(e){var t=e.id||e.name||e+"",r=e.name||t,n=e.description||void 0;return{value:t,label:r,description:n,title:n}}}],a&&Xt(i.prototype,a),u&&Xt(i,u),Object.defineProperty(i,"prototype",{writable:!1}),r}(ue.PureComponent);Nt=ar,or(ar,"EMPTY_OPTION_ID","__EMPTY__"),or(ar,"EMPTY_OPTION",Object.freeze({name:Nt.EMPTY_OPTION_ID,label:""})),or(ar,"QUERY_TYPES",[{value:e.TEMPORAL,label:"temporal",description:"Timeseries request",title:"Temporal queries target timeseries data, commonly used in graph plots"},{value:e.ENTITY,label:"current value",description:"Current value request",title:"Query the current value of one or multiple entity attributes"},{value:e.GEO,label:"geo",description:"Geo request",title:"Query the location of entities, useful for map visualizations"},{value:e.NODE_GRAPH,label:"node graph",description:"Node graph request",title:"Retrieve a directed graph dataset for the node graph panel"},{value:e.MULTITEMPORAL,label:"multitemporal",description:"Multi Temporal request",title:"Query the history of one or multiple entities"}]);var ur=new t.DataSourcePlugin(ae).setConfigEditor(Ie).setQueryEditor(ar)})(),l})()));
//# sourceMappingURL=module.js.map